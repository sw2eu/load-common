<?php

namespace Sw2\Load\Bridges\Tracy;

use Latte\Runtime\Filters;
use Nette;
use Tracy\Helpers;

?>
<style class="tracy-debug">

	#tracy-debug .sw2-LoadPanel .tracy-inner {
		width: 700px;
	}

	#tracy-debug .sw2-LoadPanel table {
		width: 100%;
		white-space: nowrap;
	}

	#tracy-debug .sw2-LoadPanel .hash {
		color: darkgray;
	}

	#tracy-debug .sw2-LoadPanel .green {
		color: green;
		font-weight: bold;
	}

	#tracy-debug .sw2-LoadPanel .red {
		color: red;
		font-weight: bold;
	}

</style>

<div class="sw2-LoadPanel">
<h1>Compiled <?php echo $this->filesCount ?> file<?php echo $this->filesCount != 1 ? 's' : '' ?></h1>

<div class="tracy-inner">
	<table>
		<?php foreach ($this->compilers as $category => $compilers): ?>
		<?php $rendered = FALSE ?>
		<?php foreach ($compilers as $compiler): ?>
		<?php foreach ($compiler->getStatistics() as $name => $statistics): ?>
		<?php if (!$rendered): ?>
		<tr>
			<th><?php echo ucfirst($category) ?> files</th>
			<th>Source file</th>
			<th>Last change</th>
			<th>Took</th>
			<th>Size</th>
		</tr>
		<?php $rendered = TRUE; endif ?>
		<tr>
			<td title="<?php echo htmlSpecialChars($statistics['path']) ?>"><?php echo htmlSpecialChars($name) ?></td>
			<td>
				<?php if (is_array($statistics['file'])): ?>
				<span class="tracy-toggle tracy-collapsed">
					<span class="tracy-dump"><?php echo count($statistics['file']) ?> files</span>
				</span>
				<div class="tracy-collapsed">
					<?php foreach ($statistics['file'] as $file): ?>
						<?php echo Helpers::editorLink($file) ?><br>
					<?php endforeach ?>
				</div>
				<?php else: ?>
				<?php echo Helpers::editorLink($statistics['file']) ?>
				<?php endif ?>
			</td>
			<td><?php echo Filters::date($statistics['date'], 'Y-m-d H:i:s') ?></td>
			<td class="<?php echo empty($statistics['time']) ? 'green' : 'red'?>">
				<?php echo empty($statistics['time']) ? 'cached' : sprintf('%0.1fâ€¯ms', $this->elapsedTime * 1000) ?>
			</td>
			<td><?php echo Filters::bytes($statistics['size']) ?></td>
		</tr>
		<?php endforeach ?>
		<?php endforeach ?>
		<?php endforeach ?>
	</table>
</div>
</div>
